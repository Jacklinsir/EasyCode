(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{549:function(s,t,a){"use strict";a.r(t);var e=a(12),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一-、背景介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-、背景介绍"}},[s._v("#")]),s._v(" 一 、背景介绍")]),s._v(" "),a("blockquote",[a("p",[s._v("不慌不忙，赶上了阿里云的双十一活动，用了三个不同的阿里云账号购买了三台不通地区的阿里云服务器，反正我觉得是一次成功的薅羊毛，哈哈哈，不知道你们有没有这样认知，但是购买后我才发现，ECS服务器内网是不能互通的，正赶巧我刚好要自建一个基于ECS服务器的K8S集群，然后因为网络问题折腾了好久，估计最少3天，差点就想放弃了，然后我鼓起勇气在Google搜索资料发现，可以搞虚拟一张网卡，IP用当前节点的公网IP，然后使用此IP注册进集群。总算看到了希望，哈哈哈，下面我们开始填坑摸索吧！")])]),s._v(" "),a("h2",{attrs:{id:"二、环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、环境准备"}},[s._v("#")]),s._v(" 二、环境准备")]),s._v(" "),a("h3",{attrs:{id:"_2-1-ecs云服务资源清单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-ecs云服务资源清单"}},[s._v("#")]),s._v(" 2.1 ECS云服务资源清单")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("云服务商")]),s._v(" "),a("th",[s._v("主机名")]),s._v(" "),a("th",[s._v("公网ip/私网ip")]),s._v(" "),a("th",[s._v("推荐配置")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("阿里云")]),s._v(" "),a("td",[s._v("zanzancloud-k8s-master")]),s._v(" "),a("td",[s._v("123.57.36.xx / 172.20.213.xx")]),s._v(" "),a("td",[s._v("2C2G")])]),s._v(" "),a("tr",[a("td",[s._v("阿里云")]),s._v(" "),a("td",[s._v("zanzancloud-k8s-node1")]),s._v(" "),a("td",[s._v("60.205.227.xx / 172.16.198.xx")]),s._v(" "),a("td",[s._v("2C4G")])]),s._v(" "),a("tr",[a("td",[s._v("阿里云")]),s._v(" "),a("td",[s._v("zanzancloud-k8s-node2")]),s._v(" "),a("td",[s._v("123.56.148.xx / 172.22.51.xx")]),s._v(" "),a("td",[s._v("2C2G")])])])]),s._v(" "),a("h3",{attrs:{id:"_2-2-k8s软件列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-k8s软件列表"}},[s._v("#")]),s._v(" 2.2  K8s软件列表")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("软件")]),s._v(" "),a("th",[s._v("版本")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("CentOS")]),s._v(" "),a("td",[s._v("7.8")])]),s._v(" "),a("tr",[a("td",[s._v("Kubernetes")]),s._v(" "),a("td",[s._v("v1.18.6")])]),s._v(" "),a("tr",[a("td",[s._v("Docker")]),s._v(" "),a("td",[s._v("20.10.10")])]),s._v(" "),a("tr",[a("td",[s._v("Etcd")]),s._v(" "),a("td",[s._v("3.4.3-0")])]),s._v(" "),a("tr",[a("td",[s._v("Flannel")]),s._v(" "),a("td",[s._v("20.10.10")])]),s._v(" "),a("tr",[a("td",[s._v("Pause")]),s._v(" "),a("td",[s._v("3.2")])]),s._v(" "),a("tr",[a("td",[s._v("DNS")]),s._v(" "),a("td",[s._v("1.6.7")])])])]),s._v(" "),a("h2",{attrs:{id:"三、阿里云ecs服务器网络问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、阿里云ecs服务器网络问题"}},[s._v("#")]),s._v(" 三、阿里云ECS服务器网络问题")]),s._v(" "),a("h3",{attrs:{id:"_3-1-问题阐述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-问题阐述"}},[s._v("#")]),s._v(" 3.1 问题阐述")]),s._v(" "),a("blockquote",[a("p",[s._v('一般情况下，"kubeadm"部署集群时指定"--apiserver-advertise-address=<public_ip>"参数，即可在其他机器上，通过公网ip join到本机器，然而，阿里云ecs里没配置公网ip，etcd会无法启动，导致初始化失败!')])]),s._v(" "),a("h3",{attrs:{id:"_3-2-解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-解决方案"}},[s._v("#")]),s._v(" 3.2 解决方案")]),s._v(" "),a("blockquote",[a("p",[s._v("当我部署k8s集群的时候发现，网卡上绑定的地址不是公网IP，而应用只能绑定网卡上的地址。但是私网IP之间又不通。当时内心是崩溃的！最后在官方文档得知，可以采用公网IP部署，具体参考："),a("a",{attrs:{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init-phase/",target:"_blank",rel:"noopener noreferrer"}},[s._v("传送门-公网安装k8s"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"四、服务节点调整-master-node1-node2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、服务节点调整-master-node1-node2"}},[s._v("#")]),s._v(" 四、服务节点调整（master，node1，node2）")]),s._v(" "),a("h3",{attrs:{id:"_4-1-关闭firewalld防火墙-并安装设置iptables规则为空"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-关闭firewalld防火墙-并安装设置iptables规则为空"}},[s._v("#")]),s._v(" 4.1 关闭firewalld防火墙，并安装设置Iptables规则为空")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭firewalld防火墙")]),s._v("\nsystemctl stop firewalld "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("  systemctl  disable firewal\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装Iptables")]),s._v("\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iptables-services  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("  systemctl  start iptables  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("  systemctl  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" iptables"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("  iptables -F  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables save\n")])])]),a("h3",{attrs:{id:"_4-2-调整内核参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-调整内核参数"}},[s._v("#")]),s._v(" 4.2 调整内核参数")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" k8s.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n#开启网桥模式\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\n#开启转发\nnet.ipv4.ip_forward = 1\n##关闭ipv6\nnet.ipv6.conf.all.disable_ipv6=1\nEOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" k8s.conf /etc/sysctl.d/k8s.conf\nsysctl -p /etc/sysctl.d/k8s.conf\n")])])]),a("h3",{attrs:{id:"_4-3-关闭-swap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-关闭-swap"}},[s._v("#")]),s._v(" 4.3 关闭 swap")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭 swap")]),s._v("\nswapoff -a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/ swap / s/^\\(.*\\)$/#\\1/g'")]),s._v(" /etc/fstab\n")])])]),a("h3",{attrs:{id:"_4-4-关闭-selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-关闭-selinux"}},[s._v("#")]),s._v(" 4.4 关闭 selinux")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭 selinux")]),s._v("\nsetenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^SELINUX=.*/SELINUX=disabled/'")]),s._v(" /etc/selinux/config\n")])])]),a("h3",{attrs:{id:"_4-5-设置hostname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-设置hostname"}},[s._v("#")]),s._v(" 4.5 设置hostname")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置hostname")]),s._v("\nhostnamectl set-hostname zanzancloud-k8s-master  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# zanzancloud-k8s-node1 / zanzancloud-k8s-node2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置host映射")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n123.57.36.xx  zanzancloud-k8s-master\n60.205.227.xx zanzancloud-k8s-node1\n123.56.148.xx zanzancloud-k8s-node2\nEOF")]),s._v("\n")])])]),a("h3",{attrs:{id:"_4-6-调整服务器时区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-调整服务器时区"}},[s._v("#")]),s._v(" 4.6 调整服务器时区")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置系统时区为 中国/上海")]),s._v("\ntimedatectl set-timezone Asia/Shanghai\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将当前的UTC时间写入硬件时钟")]),s._v("\ntimedatectl set-local-rtc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启依赖于系统时间的服务")]),s._v("\nsystemctl restart rsyslog\nsystemctl restart crond\n")])])]),a("h3",{attrs:{id:"_4-7-关闭邮件服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-关闭邮件服务"}},[s._v("#")]),s._v(" 4.7 关闭邮件服务")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭邮件服务")]),s._v("\nsystemctl stop postfix "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl disable postfix\n")])])]),a("h3",{attrs:{id:"_4-8-设置rsyslogd和systemd-journald"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-设置rsyslogd和systemd-journald"}},[s._v("#")]),s._v(" 4.8 设置rsyslogd和systemd journald")]),s._v(" "),a("p",[a("strong",[s._v("默认有两个日志服务，使用journald关闭rsyslogd")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 持久化保存日志的目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /var/log/journal\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/systemd/journald.conf.d\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/systemd/journald.conf.d/99-prophet.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Journal]\n# 持久化\nStorage=persistent\n\n# 压缩历史日志\nCompress=yes\n\nSysnIntervalSec=5m\nRateLimitInterval=30s\nRateLimitBurst=1000\n\n# 最大占用空间 10G\nSystemMaxUse=10G\n\n# 单日志文件最大 200M\nSystemMaxFileSize=200M\n\n# 日志保存时间 2 周\nMaxRetentionSec=2week\n\n# 不将日志转发到 syslog\nForwardToSyslog=no\n\nEOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启journald")]),s._v("\nsystemctl restart systemd-journald\n")])])]),a("h3",{attrs:{id:"_4-9-ipvs前置条件准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-9-ipvs前置条件准备"}},[s._v("#")]),s._v(" 4.9 ipvs前置条件准备")]),s._v(" "),a("p",[a("strong",[s._v("ipvs转发效率比iptables更高,看上去也比iptables舒服")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("modprobe br_netfilter\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysconfig/modules/ipvs.modules "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" /etc/sysconfig/modules/ipvs.modules "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" /etc/sysconfig/modules/ipvs.modules "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" lsmod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -e ip_vs -e nf_conntrack_ipv4\n")])])]),a("h3",{attrs:{id:"_4-10-安装-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-10-安装-docker"}},[s._v("#")]),s._v(" 4.10 安装 Docker")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum list docker-ce --showduplicates | sort -r")]),s._v("\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce-20.10.6-3.el7\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start docker\ndocker --version\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 换成阿里Docker仓库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/docker/daemon.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n  "registry-mirrors": [" https://wl5zc6br.mirror.aliyuncs.com"]\n}\nEOF')]),s._v("\nsystemctl restart docker\ndocker info\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# out info")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Registry Mirrors:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  https://wl5zc6br.mirror.aliyuncs.com/")]),s._v("\n")])])]),a("h3",{attrs:{id:"_4-11-安装-kubeadm、kubelet、kubectl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-11-安装-kubeadm、kubelet、kubectl"}},[s._v("#")]),s._v(" 4.11 安装 Kubeadm、Kubelet、Kubectl")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加源")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo")]),s._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭selinux")]),s._v("\nsetenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装kubelet、kubeadm、kubectl")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubelet kubeadm kubectl\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置为开机自启")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet \n")])])]),a("h3",{attrs:{id:"_4-12-阿里云ecs安全组端口开放"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-12-阿里云ecs安全组端口开放"}},[s._v("#")]),s._v(" 4.12 阿里云ECS安全组端口开放")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("10250/10260")]),s._v(" TCP端口：给kube-schedule、kube-controll，kube-proxy、kubelet等使用")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("6443")]),s._v(" TCP端口：给kube-apiserver使用")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("2379 2380 2381")]),s._v(" TCP商品：ETCD使用")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("8472")]),s._v(" UDP端口：vxlan使用端口")])])]),s._v(" "),a("h2",{attrs:{id:"五、kubeadm安装k8s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、kubeadm安装k8s"}},[s._v("#")]),s._v(" 五、Kubeadm安装k8s")]),s._v(" "),a("h3",{attrs:{id:"_5-1-建立虚拟网卡-master-node1-node2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-建立虚拟网卡-master-node1-node2"}},[s._v("#")]),s._v(" 5.1 建立虚拟网卡（master，node1，node2）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入虚拟网卡")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysconfig/network-scripts/ifcfg-eth0:1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nBOOTPROTO=static\nDEVICE=eth0:1\nIPADDR=你的公网IP\nPREFIX=32\nTYPE=Ethernet\nUSERCTL=no\nONBOOT=yes\nEOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启网卡")]),s._v("\nsystemctl restart network\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看ip")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr\n")])])]),a("h3",{attrs:{id:"_5-2-修改kubelet启动参数-master-node1-node2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-修改kubelet启动参数-master-node1-node2"}},[s._v("#")]),s._v(" 5.2 修改kubelet启动参数（master，node1，node2）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此文件安装kubeadm后就存在了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意，这步很重要，如果不做，节点仍然会使用内网IP注册进集群")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在末尾添加参数 --node-ip=公网IP")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Note: This dropin only works with kubeadm and kubelet v1.11+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# This is a file that "kubeadm init" and "kubeadm join" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-/var/lib/kubelet/kubeadm-flags.env\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-/etc/sysconfig/kubelet\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/kubelet "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBELET_KUBECONFIG_ARGS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBELET_CONFIG_ARGS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBELET_KUBEADM_ARGS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBELET_EXTRA_ARGS")]),s._v(" --node-ip"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("公网IP\n")])])]),a("h3",{attrs:{id:"_5-3-使用脚本导入镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-使用脚本导入镜像"}},[s._v("#")]),s._v(" 5.3 使用脚本导入镜像")]),s._v(" "),a("h4",{attrs:{id:"_5-3-1-master节点镜像导入脚本-pull-k8s-images-master-sh-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-master节点镜像导入脚本-pull-k8s-images-master-sh-master"}},[s._v("#")]),s._v(" 5.3.1 Master节点镜像导入脚本(pull_k8s_images_master.sh)-(master)")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -o errexit\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -o nounset\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -o pipefail\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里定义版本，按照上面得到的列表自己改一下版本号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1.18.6\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_PAUSE_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.4")]),s._v(".3-0\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DNS_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),s._v(".7\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这是原始仓库名，最后需要改名成这个")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GCR_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("k8s.gcr.io\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里就是写你要使用的仓库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKERHUB_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gotok8s\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里是镜像列表，新版本要把coredns改成coredns/coredns")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("images")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nkube-proxy:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_VERSION}")]),s._v("\nkube-scheduler:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_VERSION}")]),s._v("\nkube-controller-manager:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_VERSION}")]),s._v("\nkube-apiserver:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_VERSION}")]),s._v("\npause:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_PAUSE_VERSION}")]),s._v("\netcd:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_VERSION}")]),s._v("\ncoredns:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DNS_VERSION}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里是拉取和改名的循环语句")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("imageName")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  docker pull "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKERHUB_URL")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n  docker tag "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKERHUB_URL")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GCR_URL")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n  docker rmi "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKERHUB_URL")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),a("h4",{attrs:{id:"_5-3-2-node节点镜像导入脚本-pull-k8s-images-node-sh-node1-node2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-2-node节点镜像导入脚本-pull-k8s-images-node-sh-node1-node2"}},[s._v("#")]),s._v(" 5.3.2 Node节点镜像导入脚本(pull_k8s_images_node.sh)-(node1，node2)")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -o errexit\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -o nounset\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -o pipefail\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里定义版本，按照上面得到的列表自己改一下版本号")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1.18.6\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_PAUSE_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.4")]),s._v(".3-0\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DNS_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),s._v(".7\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这是原始仓库名，最后需要改名成这个")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GCR_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("k8s.gcr.io\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里就是写你要使用的仓库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKERHUB_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gotok8s\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里是镜像列表，新版本要把coredns改成coredns/coredns")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("images")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nkube-proxy:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_VERSION}")]),s._v("\npause:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_PAUSE_VERSION}")]),s._v("\netcd:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_VERSION}")]),s._v("\ncoredns:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DNS_VERSION}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里是拉取和改名的循环语句")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("imageName")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  docker pull "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKERHUB_URL")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n  docker tag "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKERHUB_URL")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GCR_URL")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n  docker rmi "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKERHUB_URL")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),a("h3",{attrs:{id:"_5-4-使用kubeadm初始化主节点-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-使用kubeadm初始化主节点-master"}},[s._v("#")]),s._v(" 5.4 使用kubeadm初始化主节点（master）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step1 添加配置文件，注意替换下面的IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubeadm-config.yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\napiVersion: kubeadm.k8s.io/v1beta2\nkind: ClusterConfiguration\nkubernetesVersion: v1.18.0\napiServer:\n  certSANs:    #填写所有kube-apiserver节点的hostname、IP、VIP\n  - zanzancloud-k8s-master    #请替换为hostname\n  - 123.57.36.xx   #请替换为公网\n  - 172.20.213.xx  #请替换为私网\n  - 10.96.0.1   #不要替换，此IP是API的集群地址，部分服务会用到\ncontrolPlaneEndpoint: 47.74.22.13:6443 #替换为公网IP\nnetworking:\n  podSubnet: 10.244.0.0/16\n  serviceSubnet: 10.96.0.0/12\n--- 将默认调度方式改为ipvs\napiVersion: kubeproxy-config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nfeatureGates:\n  SupportIPVSProxyMode: true\nmode: ipvs\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是1核心或者1G内存的请在末尾添加参数（--ignore-preflight-errors=all），否则会初始化失败!")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时注意，此步骤成功后，会打印，两个重要信息!")]),s._v("\n\nkubeadm init --config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubeadm-config.yaml \n")])])]),a("p",[a("strong",[s._v("注意：")])]),s._v(" "),a("blockquote",[a("p",[s._v("信息1 上面初始化成功后，将会生成kubeconfig文件，用于请求api服务器，请执行下面操作")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])])]),a("p",[s._v("信息2 此信息用于后面工作节点加入主节点使用")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.57")]),s._v(".36.xx:6443 --token abcdef.0123456789abcdef "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   --discovery-token-ca-cert-hash sha256:28265e79f8695cf2ad2e23773e856c8b04c809b0e3b3d6f5e01fb1b543341065\n")])])])]),s._v(" "),a("h3",{attrs:{id:"_5-5-配置kube-apiserver参数-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-配置kube-apiserver参数-master"}},[s._v("#")]),s._v(" 5.5 配置kube-apiserver参数（master）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改两个信息，添加--bind-address和修改--advertise-address")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/kubernetes/manifests/kube-apiserver.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  annotations:\n    kubeadm.kubernetes.io/kube-apiserver.advertise-address.endpoint: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.57")]),s._v(".36.xx:6443\n  creationTimestamp: null\n  labels:\n    component: kube-apiserver\n    tier: control-plane\n  name: kube-apiserver\n  namespace: kube-system\nspec:\n  containers:\n  - command:\n    - kube-apiserver\n    - --advertise-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.57")]),s._v(".36.xx  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改为公网IP")]),s._v("\n    - --bind-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加此参数")]),s._v("\n    - --allow-privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n    - --authorization-mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Node,RBAC\n    - --client-ca-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/ca.crt\n    - --enable-admission-plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodeRestriction\n    - --enable-bootstrap-token-auth"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n    - --etcd-cafile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/etcd/ca.crt\n    - --etcd-certfile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/apiserver-etcd-client.crt\n    - --etcd-keyfile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/apiserver-etcd-client.key\n    - --etcd-servers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://127.0.0.1:2379\n    - --insecure-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    - --kubelet-client-certificate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/apiserver-kubelet-client.crt\n    - --kubelet-client-key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/apiserver-kubelet-client.key\n    - --kubelet-preferred-address-types"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("InternalIP,ExternalIP,Hostname\n    - --proxy-client-cert-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/front-proxy-client.crt\n    - --proxy-client-key-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/front-proxy-client.key\n    - --requestheader-allowed-names"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("front-proxy-client\n    - --requestheader-client-ca-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/front-proxy-ca.crt\n    - --requestheader-extra-headers-prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("X-Remote-Extra-\n    - --requestheader-group-headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("X-Remote-Group\n    - --requestheader-username-headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("X-Remote-User\n    - --secure-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\n    - --service-account-key-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/sa.pub\n    - --service-cluster-ip-range"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.0/12\n    - --tls-cert-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/apiserver.crt\n    - --tls-private-key-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/apiserver.key\n    image: k8s.gcr.io/kube-apiserver:v1.18.0\n    imagePullPolicy: IfNotPresent\n    livenessProbe:\n      failureThreshold: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n      httpGet:\n        host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("175.24")]),s._v(".19.12\n        path: /healthz\n        port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\n        scheme: HTTPS\n      initialDelaySeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n      timeoutSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n    name: kube-apiserver\n    resources:\n      requests:\n        cpu: 250m\n    volumeMounts:\n    - mountPath: /etc/ssl/certs\n      name: ca-certs\n      readOnly: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - mountPath: /etc/pki\n      name: etc-pki\n      readOnly: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - mountPath: /etc/kubernetes/pki\n      name: k8s-certs\n      readOnly: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  hostNetwork: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  priorityClassName: system-cluster-critical\n  volumes:\n  - hostPath:\n      path: /etc/ssl/certs\n      type: DirectoryOrCreate\n    name: ca-certs\n  - hostPath:\n      path: /etc/pki\n      type: DirectoryOrCreate\n    name: etc-pki\n  - hostPath:\n      path: /etc/kubernetes/pki\n      type: DirectoryOrCreate\n    name: k8s-certs\nstatus: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h3",{attrs:{id:"_5-6-node点加入集群-node1-node2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-node点加入集群-node1-node2"}},[s._v("#")]),s._v(" 5.6 Node点加入集群（node1，node2）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要虚拟IP和kubelet启动参数都改成功后，再执行")]),s._v("\nkubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.57")]),s._v(".36.xx:6443 --token abcdef.0123456789abcdef "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   --discovery-token-ca-cert-hash sha256:28265e79f8695cf2ad2e23773e856c8b04c809b0e3b3d6f5e01fb1b543341065\n")])])]),a("h3",{attrs:{id:"_5-7-检查是否加入集群-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-7-检查是否加入集群-master"}},[s._v("#")]),s._v(" 5.7 检查是否加入集群（Master）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 成功后，INTERNAL-IP均显示公网IP")]),s._v("\nkubectl get nodes -o wide\n")])])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/cbb6ec40e5c24fd5b8ca39c23ef52a89.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_5-8-配置flannel文件并安装-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-8-配置flannel文件并安装-master"}},[s._v("#")]),s._v(" 5.8 配置flannel文件并安装（Master）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /var/lib/k8s/flannel\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载flannel网络插件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 共修改两个地方，一个是args下，添加")]),s._v("\n args:\n - --public-ip"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("PUBLIC_IP"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加此参数，申明公网IP")]),s._v("\n - --iface"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth0             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加此参数，绑定网卡")]),s._v("\n \n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后是env下")]),s._v("\n env:\n - name: PUBLIC_IP     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加环境变量")]),s._v("\n   valueFrom:          \n     fieldRef:          \n       fieldPath: status.podIP \n\n")])])]),a("p",[a("strong",[s._v("kube-flannel.yml完整配置")])]),s._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" policy/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PodSecurityPolicy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" psp.flannel.unprivileged\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("seccomp.security.alpha.kubernetes.io/allowedProfileNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker/default\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("seccomp.security.alpha.kubernetes.io/defaultProfileName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker/default\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apparmor.security.beta.kubernetes.io/allowedProfileNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" runtime/default\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apparmor.security.beta.kubernetes.io/defaultProfileName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" runtime/default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" configMap\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" secret\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" emptyDir\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" hostPath\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowedHostPaths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/cni/net.d"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kube-flannel"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/run/flannel"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("readOnlyRootFilesystem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Users and groups")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runAsUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("supplementalGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fsGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Privilege Escalation")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowPrivilegeEscalation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultAllowPrivilegeEscalation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Capabilities")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowedCapabilities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NET_ADMIN'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NET_RAW'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultAddCapabilities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requiredDropCapabilities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Host namespaces")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostIPC")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostNetwork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPorts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("min")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELinux")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("seLinux")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELinux is unused in CaaSP")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RunAsAny'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'extensions'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'podsecuritypolicies'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'use'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'psp.flannel.unprivileged'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" pods\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" get\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nodes\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" list\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" watch\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nodes/status\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" patch\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRoleBinding\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConfigMap\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cfg\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tier")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cni-conf.json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n    {\n      "name": "cbr0",\n      "cniVersion": "0.3.1",\n      "plugins": [\n        {\n          "type": "flannel",\n          "delegate": {\n            "hairpinMode": true,\n            "isDefaultGateway": true\n          }\n        },\n        {\n          "type": "portmap",\n          "capabilities": {\n            "portMappings": true\n          }\n        }\n      ]\n    }')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("net-conf.json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n    {\n      "Network": "10.244.0.0/16",\n      "Backend": {\n        "Type": "vxlan"\n      }\n    }')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DaemonSet\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ds\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tier")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tier")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("affinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeAffinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requiredDuringSchedulingIgnoredDuringExecution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelectorTerms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchExpressions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubernetes.io/os\n                    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" In\n                    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" linux\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostNetwork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("priorityClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("critical\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Exists\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NoSchedule\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccountName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("initContainers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cni"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("plugin\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rancher/mirrored"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannelcni"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cni"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("plugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.2\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cp\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /flannel\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /opt/cni/bin/flannel\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cni"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("plugin\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /opt/cni/bin\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cni\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/coreos/flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.15.0\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cp\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannel/cni"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("conf.json\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/cni/net.d/10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannel.conflist\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cni\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/cni/net.d\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cfg\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannel/\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannel\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/coreos/flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.15.0\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /opt/bin/flanneld\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("masq\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("subnet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mgr\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("public"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ip=$(PUBLIC_IP)\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("iface=eth0\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100m"')]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"50Mi"')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100m"')]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"50Mi"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("capabilities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NET_ADMIN"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NET_RAW"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PUBLIC_IP\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" status.podIP\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" POD_NAME\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metadata.name\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" POD_NAMESPACE\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metadata.namespace\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" run\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /run/flannel\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cfg\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannel/\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" run\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /run/flannel\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cni"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("plugin\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /opt/cni/bin\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cni\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/cni/net.d\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cfg\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cfg\n\n")])])]),a("h3",{attrs:{id:"_5-9-创建flannel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-创建flannel"}},[s._v("#")]),s._v(" 5.9 创建flannel")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply -f flannel.yaml\n")])])]),a("h3",{attrs:{id:"_5-10-检查网络是否连通-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-10-检查网络是否连通-master"}},[s._v("#")]),s._v(" 5.10 检查网络是否连通(master)")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查pod是否都是ready状态")]),s._v("\nkubectl get pods -o wide --all-namespaces\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 手动创建一个pod")]),s._v("\nkubectl create deployment nginx --image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pod的ip")]),s._v("\nkubectl get pods -o wide\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主节点或其它节点，ping一下此ip,看看是否能ping通")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有的话，查看2.9章节中说明的端口是否打开")]),s._v("\n")])])]),a("h3",{attrs:{id:"_5-11-手动开启配置-开启ipvs转发模式-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-11-手动开启配置-开启ipvs转发模式-master"}},[s._v("#")]),s._v(" 5.11 手动开启配置，开启ipvs转发模式（master）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前面都成功了，但是有时候默认并不会启用`IPVS`模式，那就手动修改一下，只修改一处")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改后，如果没有及时生效，请删除kube-proxy，会自动重新创建，然后使用ipvsadm -Ln命令，查看是否生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ipvsadm没有安装的，使用yum install ipvsadm安装")]),s._v("\nkubectl edit configmaps -n kube-system kube-proxy\n\n---\napiVersion: v1\ndata:\n  config.conf: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-\n    apiVersion: kubeproxy.config.k8s.io/v1alpha1\n    bindAddress: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n    clientConnection:\n      acceptContentTypes: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n      burst: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n      contentType: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n      kubeconfig: /var/lib/kube-proxy/kubeconfig.conf\n      qps: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    clusterCIDR: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16\n    configSyncPeriod: 0s\n    conntrack:\n      maxPerCore: null\n      min: null\n      tcpCloseWaitTimeout: null\n      tcpEstablishedTimeout: null\n    detectLocalMode: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    enableProfiling: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    healthzBindAddress: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    hostnameOverride: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    iptables:\n      masqueradeAll: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      masqueradeBit: null\n      minSyncPeriod: 0s\n      syncPeriod: 0s\n    ipvs:\n      excludeCIDRs: null\n      minSyncPeriod: 0s\n      scheduler: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n      strictARP: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      syncPeriod: 0s\n      tcpFinTimeout: 0s\n      tcpTimeout: 0s\n      udpTimeout: 0s\n    kind: KubeProxyConfiguration\n    metricsBindAddress: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    mode: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ipvs"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果为空，请填入`ipvs`")]),s._v("\n    nodePortAddresses: null\n    oomScoreAdj: null\n    portRange: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    showHiddenMetricsForVersion: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    udpIdleTimeout: 0s\n    winkernel:\n      enableDSR: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      networkName: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])])]),a("p",[a("strong",[s._v("预期结果如下图：")]),s._v(" "),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/2798a6ac29e7433fad8bb105120b7f5f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5oqA5pyv5o-P6L-w5Lq655Sf,size_20,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_5-12-移除虚拟网卡-非必须"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-12-移除虚拟网卡-非必须"}},[s._v("#")]),s._v(" 5.12 移除虚拟网卡(非必须)")]),s._v(" "),a("blockquote",[a("p",[s._v("注意： 此步骤，可以不执行，因为实测不移除，节点间的网络也通了，如果是centos8网络不通，再执行下面的操作，移除虚拟虚拟网卡")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除虚拟网卡")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /etc/sysconfig/network-scripts/ifcfg-eth0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":1 /root/\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n")])])]),a("h2",{attrs:{id:"六、安装默认的storageclass"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、安装默认的storageclass"}},[s._v("#")]),s._v(" 六、安装默认的StorageClass")]),s._v(" "),a("h3",{attrs:{id:"_6-1-master和node节点安装nfs服务-master-node1-node2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-master和node节点安装nfs服务-master-node1-node2"}},[s._v("#")]),s._v(" 6.1 master和node节点安装nfs服务(master，node1，node2 )")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nfs-utils rpcbind\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动nfs并设为开机自启")]),s._v("\nsystemctl start nfs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nfs\nsystemctl start rpcbind "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rpcbind\n")])])]),a("h3",{attrs:{id:"_6-2-master节点创建共享挂载目录-客户端不需要创建共享目录和编辑配置文件-只安装服务就行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-master节点创建共享挂载目录-客户端不需要创建共享目录和编辑配置文件-只安装服务就行"}},[s._v("#")]),s._v(" 6.2 master节点创建共享挂载目录（客户端不需要创建共享目录和编辑配置文件，只安装服务就行）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /data/volumes/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("v1,v2,v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h3",{attrs:{id:"_6-3-编辑master节点-etc-exports文件-将目录共享到-所有网段中-网段根据自己的情况写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-编辑master节点-etc-exports文件-将目录共享到-所有网段中-网段根据自己的情况写"}},[s._v("#")]),s._v(" 6.3 编辑master节点/etc/exports文件,将目录共享到*所有网段中：（网段根据自己的情况写）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n/data/volumes/v1  *(rw,no_root_squash,no_all_squash)\n/data/volumes/v2  *(rw,no_root_squash,no_all_squash)\n/data/volumes/v3  *(rw,no_root_squash,no_all_squash)\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布")]),s._v("\nexportfs -arv\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\nshowmount -e\n")])])]),a("p",[a("strong",[s._v("注意：")])]),s._v(" "),a("blockquote",[a("p",[s._v("* 表示所有网段支持，192.168.200.0/24表示指定网段才支持访问。")])]),s._v(" "),a("h3",{attrs:{id:"_6-4-master主节点下载-nfs-插件-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-master主节点下载-nfs-插件-master"}},[s._v("#")]),s._v(" 6.4 master主节点下载 NFS 插件(master)")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /var/lib/k8s/storage\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#----------------------------")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" class.yaml deployment.yaml rbac.yaml test-claim.yaml "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/kubernetes-incubator/external-storage/master/nfs-client/deploy/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),a("h3",{attrs:{id:"_6-5-修改deployment-yaml文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-修改deployment-yaml文件"}},[s._v("#")]),s._v(" 6.5 修改deployment.yaml文件")]),s._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("vim deployment.yaml\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# replace with namespace where provisioner is deployed")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Recreate\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccountName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/external_storage/nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##默认是latest版本")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("root\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /persistentvolumes\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PROVISIONER_NAME\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" fuseim.pri/ifs          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里的供应者名称必须和class.yaml中的provisioner的名称一致，否则部署不成功")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NFS_SERVER\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 123.57.36.19           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里写NFS服务器的IP地址或者能解析到的主机名")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NFS_PATH\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /data/volumes/v1        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里写NFS服务器中的共享挂载目录（强调：这里的路径必须是目录中最后一层的文件夹，否则部署的应用将无权限创建目录导致Pending）")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("root\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 123.57.36.19            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##NFS服务器的IP或可解析到的主机名 ")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /data/volumes/v1           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##NFS服务器中的共享挂载目录（强调：这里的路径必须是目录中最后一层的文件夹，否则部署的应用将无权限创建目录导致Pending）")]),s._v("\n")])])]),a("h3",{attrs:{id:"_6-6-部署yml文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-部署yml文件"}},[s._v("#")]),s._v(" 6.6 部署yml文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply -f "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])])]),a("h3",{attrs:{id:"_6-7-验证安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-验证安装"}},[s._v("#")]),s._v(" 6.7 验证安装")]),s._v(" "),a("p",[a("strong",[s._v("查看服务：")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods\n")])])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/f8bf5c3507874ffc8926a2a0d4568b9e.png",alt:"在这里插入图片描述"}}),s._v(" "),a("strong",[s._v("列出你的集群中的StorageClass：")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get storageclass\n")])])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/279107eecdd34a5a87336d4aef5f526e.png",alt:"在这里插入图片描述"}}),s._v(" "),a("strong",[s._v("标记一个StorageClass为默认的:")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl patch storageclass managed-nfs-storage -p "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'')]),s._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get storageclass\n")])])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/f5db8dcdcadf499f81bd4839808a8351.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_6-8-测试文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-8-测试文件"}},[s._v("#")]),s._v(" 6.8 测试文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建测试文件并写入yml配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" statefulset-nfs.yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx\n  labels:\n    app: nginx\nspec:\n  ports:\n  - port: 80\n    name: web\n  clusterIP: None\n  selector:\n    app: nginx\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: nfs-web\nspec:\n  serviceName: "nginx"\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nfs-web # has to match .spec.template.metadata.labels\n  template:\n    metadata:\n      labels:\n        app: nfs-web\n    spec:\n      terminationGracePeriodSeconds: 10\n      containers:\n      - name: nginx\n        image: nginx:1.7.9\n        ports:\n        - containerPort: 80\n          name: web\n        volumeMounts:\n        - name: www\n          mountPath: /usr/share/nginx/html\n  volumeClaimTemplates:\n  - metadata:\n      name: www\n      annotations:\n        volume.beta.kubernetes.io/storage-class: managed-nfs-storage\n    spec:\n      accessModes: [ "ReadWriteOnce" ]\n      resources:\n        requests:\n          storage: 1Gi\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装测试用例")]),s._v("\nkubectl apply -f statefulset-nfs.yaml\n")])])]),a("p",[a("strong",[s._v("查看pod：")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@zanzancloud-k8s-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods")]),s._v("\nNAME                                      READY   STATUS    RESTARTS   AGE\nnfs-client-provisioner-6d4469b5b5-m6jgp   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          47h\nnfs-web-0                                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          44m\nnfs-web-1                                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          44m\nnfs-web-2                                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          43m\n")])])]),a("p",[a("strong",[s._v("查看pvc:")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@zanzancloud-k8s-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pvc")]),s._v("\nNAME            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE\ntest-claim      Bound    pvc-5dc58dfa-bd9d-4ad3-98c4-28649c13113c   1Mi        RWX            managed-nfs-storage   47h\nwww-nfs-web-0   Bound    pvc-7cdcdc4c-e9d2-4848-b434-9caf7e72db5a   1Gi        RWO            managed-nfs-storage   45m\nwww-nfs-web-1   Bound    pvc-23e3cdb2-a365-43ff-8936-d0e3df30ffac   1Gi        RWO            managed-nfs-storage   44m\nwww-nfs-web-2   Bound    pvc-2c34b87d-4f09-4063-aea9-9ae1e7567194   1Gi        RWO            managed-nfs-storage   44m\n")])])]),a("p",[a("strong",[s._v("查看pv:")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@zanzancloud-k8s-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pv")]),s._v("\nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                             STORAGECLASS          REASON   AGE\npvc-23e3cdb2-a365-43ff-8936-d0e3df30ffac   1Gi        RWO            Delete           Bound    default/www-nfs-web-1                                             managed-nfs-storage            45m\npvc-2c34b87d-4f09-4063-aea9-9ae1e7567194   1Gi        RWO            Delete           Bound    default/www-nfs-web-2                                             managed-nfs-storage            45m\npvc-5dc58dfa-bd9d-4ad3-98c4-28649c13113c   1Mi        RWX            Delete           Bound    default/test-claim                                                managed-nfs-storage            47h\npvc-7bf72c3c-be16-43ab-b43a-a84659b9c688   20Gi       RWO            Delete           Bound    kubesphere-monitoring-system/prometheus-k8s-db-prometheus-k8s-1   managed-nfs-storage            45h\npvc-7cdcdc4c-e9d2-4848-b434-9caf7e72db5a   1Gi        RWO            Delete           Bound    default/www-nfs-web-0                                             managed-nfs-storage            46m\npvc-dfac2b35-6c22-487e-baee-f381c44a5254   20Gi       RWO            Delete           Bound    kubesphere-monitoring-system/prometheus-k8s-db-prometheus-k8s-0   managed-nfs-storage            45h\n")])])]),a("p",[a("strong",[s._v("查看 nfs server 目录中信息:")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@zanzancloud-k8s-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /data/volumes/v1")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ndrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":58 default-test-claim-pvc-5dc58dfa-bd9d-4ad3-98c4-28649c13113c\ndrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":35 default-test-claim-pvc-b68c2fde-14eb-464a-8907-f778a654e8b8\ndrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":30 default-www-nfs-web-0-pvc-7cdcdc4c-e9d2-4848-b434-9caf7e72db5a\ndrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":31 default-www-nfs-web-1-pvc-23e3cdb2-a365-43ff-8936-d0e3df30ffac\ndrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":31 default-www-nfs-web-2-pvc-2c34b87d-4f09-4063-aea9-9ae1e7567194\ndrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":44 kubesphere-monitoring-system-prometheus-k8s-db-prometheus-k8s-0-pvc-dfac2b35-6c22-487e-baee-f381c44a5254\ndrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":44 kubesphere-monitoring-system-prometheus-k8s-db-prometheus-k8s-1-pvc-7bf72c3c-be16-43ab-b43a-a84659b9c688\n")])])]),a("h2",{attrs:{id:"七、安装kubesphere监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、安装kubesphere监控"}},[s._v("#")]),s._v(" 七、安装kubeSphere监控")]),s._v(" "),a("h3",{attrs:{id:"_7-1-kubesphere架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-kubesphere架构"}},[s._v("#")]),s._v(" 7.1 kubeSphere架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/0e6d007f66b34008a6e32ed684152b9d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5oqA5pyv5o-P6L-w5Lq655Sf,size_20,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"_7-2-环境要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-环境要求"}},[s._v("#")]),s._v(" 7.2 环境要求")]),s._v(" "),a("blockquote",[a("p",[s._v("前提条件：\n1.k8s集群版本必须是1.18.x（v1.18.6）\n2.必须有默认的storageclass(上面已经安装)\n3.内存和cpu最低要求：CPU > 1 Core, Memory > 2 G")])]),s._v(" "),a("h3",{attrs:{id:"_7-3-安装yaml文件-先安装第一个-再安装第二个"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-安装yaml文件-先安装第一个-再安装第二个"}},[s._v("#")]),s._v(" 7.3.安装yaml文件 （先安装第一个，再安装第二个）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/kubesphere-installer.yaml\n   \nkubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/cluster-configuration.yaml\n")])])]),a("h3",{attrs:{id:"_7-4-安装日志查看-中间需要等待时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-安装日志查看-中间需要等待时间"}},[s._v("#")]),s._v(" 7.4 安装日志查看(中间需要等待时间)")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl logs -n kubesphere-system "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pod -n kubesphere-system -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ks-install -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.items[0].metadata.name}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" -f\n")])])]),a("h3",{attrs:{id:"_7-5-查看所有pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-查看所有pod"}},[s._v("#")]),s._v(" 7.5 查看所有pod")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@zanzancloud-k8s-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -A")]),s._v("\nNAMESPACE                      NAME                                               READY   STATUS    RESTARTS   AGE\ndefault                        nfs-client-provisioner-57944b54d5-mv895            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("          2d3h\nkube-system                    coredns-66bff467f8-k67hr                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("          3d23h\nkube-system                    coredns-66bff467f8-pvlbn                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("          3d23h\nkube-system                    etcd-zanzancloud-k8s-master                        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("          3d23h\nkube-system                    kube-apiserver-zanzancloud-k8s-master              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("          3d21h\nkube-system                    kube-controller-manager-zanzancloud-k8s-master     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("         3d23h\nkube-system                    kube-flannel-ds-6tjtn                              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          3d\nkube-system                    kube-flannel-ds-b2c6w                              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          3d\nkube-system                    kube-flannel-ds-vdssz                              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("          3d\nkube-system                    kube-proxy-dv252                                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("          3d23h\nkube-system                    kube-proxy-gfxcv                                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("          3d23h\nkube-system                    kube-proxy-mmqff                                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("          3d23h\nkube-system                    kube-scheduler-zanzancloud-k8s-master              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("         3d23h\nkube-system                    snapshot-controller-0                              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-controls-system     default-http-backend-857d7b6856-vhv55              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-controls-system     kubectl-admin-58f985d8f6-lfhc7                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-monitoring-system   alertmanager-main-0                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-monitoring-system   alertmanager-main-1                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-monitoring-system   alertmanager-main-2                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-monitoring-system   kube-state-metrics-95c974544-2jxp2                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-monitoring-system   node-exporter-7crqm                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-monitoring-system   node-exporter-jf5zs                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("          2d2h\nkubesphere-monitoring-system   node-exporter-kfpg9                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-monitoring-system   notification-manager-deployment-7c8df68d94-mc2fr   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-monitoring-system   notification-manager-deployment-7c8df68d94-tqlqm   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-monitoring-system   notification-manager-operator-6958786cd6-rbkcn     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("          40h\nkubesphere-monitoring-system   prometheus-k8s-0                                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("         2d2h\nkubesphere-monitoring-system   prometheus-k8s-1                                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("         2d2h\nkubesphere-monitoring-system   prometheus-operator-84d58bf775-x5mm2               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          2d2h\nkubesphere-system              ks-apiserver-686f9d89f5-md894                      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("          40h\nkubesphere-system              ks-console-b4df86d6f-kqh98                         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-system              ks-controller-manager-5b85577bdb-2kf9k             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("          2d2h\nkubesphere-system              ks-installer-7cb866bd-krx6k                        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-system              openldap-0                                         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\nkubesphere-system              redis-644bc597b9-t7brt                             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2d2h\n")])])]),a("h3",{attrs:{id:"_7-6-访问kubesphere"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-6-访问kubesphere"}},[s._v("#")]),s._v(" 7.6 访问kubesphere")]),s._v(" "),a("blockquote",[a("p",[s._v("访问地址：ip:30880\n账号：admin 密码： P@88w0rd")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/41d3b2d6a0ee4b52897a45669eef5601.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5oqA5pyv5o-P6L-w5Lq655Sf,size_20,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})]),s._v(" "),a("h2",{attrs:{id:"八、总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、总结"}},[s._v("#")]),s._v(" 八、总结")]),s._v(" "),a("blockquote",[a("p",[s._v("呀呀呀，总算折腾完了，经过几天不懈努力，从网络到k8s集群，再到监控端，废了九牛二虎之力，上诉流程是经过折腾总结的经验，希望对于你有所帮助！！\n"),a("HideArticle")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);